<Window x:Class="RVUCounter.Views.ToolsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Tools"
        Width="700" Height="600"
        WindowStartupLocation="Manual"
        Background="{DynamicResource WindowBackgroundBrush}"
        TextElement.Foreground="{DynamicResource PrimaryTextBrush}">

    <Window.Resources>
        <!-- TabItem style for dark theme -->
        <Style TargetType="TabItem">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border Name="Border" Background="{DynamicResource PanelBackgroundBrush}"
                                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1,1,1,0"
                                CornerRadius="4,4,0,0" Padding="12,6" Margin="2,0,0,0">
                            <ContentPresenter x:Name="ContentSite" ContentSource="Header"
                                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource CardBackgroundBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource HoverBackgroundBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Button style for dark theme -->
        <Style TargetType="Button">
            <Setter Property="Background" Value="{DynamicResource ButtonBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource ButtonTextBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Default TextBlock style for dark theme -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
        </Style>

        <!-- TextBox style -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{DynamicResource CardBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="Padding" Value="6,4"/>
        </Style>

        <!-- DatePicker style for dark theme -->
        <Style TargetType="DatePicker">
            <Setter Property="Background" Value="{DynamicResource CardBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="Padding" Value="4"/>
        </Style>

        <!-- DatePickerTextBox style for dark theme -->
        <Style TargetType="DatePickerTextBox">
            <Setter Property="Background" Value="{DynamicResource CardBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DatePickerTextBox">
                        <Grid>
                            <Border Background="{DynamicResource CardBackgroundBrush}" CornerRadius="2">
                                <TextBox x:Name="PART_TextBox"
                                         Text="{Binding Path=SelectedDate, RelativeSource={RelativeSource AncestorType=DatePicker}, StringFormat=MM/dd/yyyy}"
                                         Background="Transparent"
                                         Foreground="{DynamicResource PrimaryTextBrush}"
                                         BorderThickness="0"
                                         Padding="4,2"
                                         IsReadOnly="True"/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl Grid.Row="0" Background="{DynamicResource PanelBackgroundBrush}" BorderBrush="{DynamicResource BorderBrush}">

            <!-- Tab 1: Database Repair -->
            <TabItem Header="Database Repair">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,15">
                        <TextBlock Text="Database Repair" FontWeight="Bold" FontSize="14"/>
                        <TextBlock Text="Fix internal database issues against current RVU rules."
                                   Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,5,0,0"/>
                    </StackPanel>

                    <!-- Stats -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBlock Text="Total Shifts: "/>
                        <TextBlock Text="{Binding TotalShifts}" FontWeight="Bold" Margin="0,0,20,0"/>
                        <TextBlock Text="Total Studies: "/>
                        <TextBlock Text="{Binding TotalStudies}" FontWeight="Bold" Margin="0,0,20,0"/>
                        <TextBlock Text="Total RVU: "/>
                        <TextBlock Text="{Binding TotalRvu, StringFormat=F1}" FontWeight="Bold"/>
                    </StackPanel>

                    <!-- Buttons -->
                    <WrapPanel Grid.Row="2" Margin="0,0,0,15">
                        <Button Content="Scan" Margin="0,0,8,8"
                                Command="{Binding ScanDatabaseCommand}"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"
                                ToolTip="Scan database for issues"/>
                        <Button Content="Fix" Margin="0,0,8,8"
                                Command="{Binding FixDatabaseCommand}"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"
                                ToolTip="Fix zero-RVU and unknown study types"/>
                        <Button Content="Open Folder" Margin="0,0,8,8"
                                Command="{Binding OpenDatabaseFolderCommand}"
                                ToolTip="Open database folder"/>
                        <Button Content="View Logs" Margin="0,0,8,8"
                                Command="{Binding ViewLogsCommand}"
                                ToolTip="Open logs folder"/>
                    </WrapPanel>

                    <!-- Report Output -->
                    <Border Grid.Row="3" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                            CornerRadius="4" Background="{DynamicResource CardBackgroundBrush}">
                        <ScrollViewer>
                            <TextBox Text="{Binding ReportText}"
                                     IsReadOnly="True"
                                     FontFamily="Consolas"
                                     FontSize="11"
                                     TextWrapping="Wrap"
                                     BorderThickness="0"
                                     Padding="10"
                                     Background="Transparent"
                                     VerticalScrollBarVisibility="Auto"/>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Tab 2: Payroll Reconciliation -->
            <TabItem Header="Payroll Reconciliation">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,10">
                        <TextBlock Text="Payroll Reconciliation" FontWeight="Bold" FontSize="14"/>
                        <TextBlock Text="Sync database with payroll Excel file. Select a file, then use the operations below."
                                   Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,5,0,0" TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- File Selection -->
                    <Grid Grid.Row="1" Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Excel File:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBox Grid.Column="1" Text="{Binding ExcelFilePath}" IsReadOnly="True"/>
                        <Button Grid.Column="2" Content="Browse..." Margin="10,0,0,0"
                                Command="{Binding BrowseExcelFileCommand}"/>
                    </Grid>

                    <!-- Date Range -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBlock Text="Date Range:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <DatePicker SelectedDate="{Binding AuditStartDate}" Width="120"/>
                        <TextBlock Text=" to " VerticalAlignment="Center"/>
                        <DatePicker SelectedDate="{Binding AuditEndDate}" Width="120"/>
                    </StackPanel>

                    <!-- Operation Buttons -->
                    <Grid Grid.Row="3" Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Left Column: Audit & Reconcile -->
                        <StackPanel Grid.Column="0" Margin="0,0,10,0">
                            <TextBlock Text="Audit &amp; Reconcile" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            <WrapPanel>
                                <Button Content="Audit" Margin="0,0,8,8"
                                        Command="{Binding RunAuditCommand}"
                                        IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"
                                        ToolTip="Compare accessions between Excel and database"/>
                                <Button Content="Check RVU" Margin="0,0,8,8"
                                        Command="{Binding CheckRvuCommand}"
                                        IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"
                                        ToolTip="Find RVU value discrepancies"/>
                                <Button Content="Reconcile" Margin="0,0,8,8"
                                        Command="{Binding ReconcileDatabaseCommand}"
                                        IsEnabled="{Binding CanReconcile}"
                                        ToolTip="Add missing and delete extra records"/>
                            </WrapPanel>
                        </StackPanel>

                        <!-- Right Column: Time Sync -->
                        <StackPanel Grid.Column="1" Margin="10,0,0,0">
                            <TextBlock Text="Time Sync" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            <WrapPanel>
                                <Button Content="Detect Offset" Margin="0,0,8,8"
                                        Command="{Binding DetectTimeOffsetCommand}"
                                        IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"
                                        ToolTip="Calculate time difference between Excel and database"/>
                                <Button Content="Apply Offset" Margin="0,0,8,8"
                                        Command="{Binding ApplyTimeOffsetCommand}"
                                        IsEnabled="{Binding CanApplyTimeSync}"
                                        ToolTip="Apply detected time offset to current shift"/>
                            </WrapPanel>
                        </StackPanel>
                    </Grid>

                    <!-- Report Output -->
                    <Border Grid.Row="4" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                            CornerRadius="4" Background="{DynamicResource CardBackgroundBrush}">
                        <ScrollViewer>
                            <TextBox Text="{Binding ReportText}"
                                     IsReadOnly="True"
                                     FontFamily="Consolas"
                                     FontSize="11"
                                     TextWrapping="Wrap"
                                     BorderThickness="0"
                                     Padding="10"
                                     Background="Transparent"
                                     VerticalScrollBarVisibility="Auto"/>
                        </ScrollViewer>
                    </Border>

                    <!-- Export Button -->
                    <Button Grid.Row="5" Content="Export Report" HorizontalAlignment="Right" Margin="0,10,0,0"
                            Command="{Binding ExportReportCommand}"/>
                </Grid>
            </TabItem>

            <!-- Tab 3: Backup & Restore -->
            <TabItem Header="Backup &amp; Restore">
                <StackPanel Margin="15">
                    <!-- Header -->
                    <TextBlock Text="Backup &amp; Restore" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                    <TextBlock Text="Export or import your database and settings."
                               Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,20"/>

                    <!-- Export Section -->
                    <TextBlock Text="Export" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <WrapPanel Margin="0,0,0,20">
                        <Button Content="Export Database..." Margin="0,0,10,0" Width="160"
                                Command="{Binding ExportDatabaseCommand}"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"/>
                        <Button Content="Export Settings..." Width="160"
                                Command="{Binding ExportSettingsCommand}"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"/>
                    </WrapPanel>

                    <Separator Background="{DynamicResource SeparatorBrush}" Margin="0,0,0,20"/>

                    <!-- Import Section -->
                    <TextBlock Text="Import" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <Button Content="Import Database..." Width="160" HorizontalAlignment="Left"
                            Command="{Binding ImportDatabaseCommand}"
                            IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"/>

                    <TextBlock Text="Note: After importing a database, restart the application for changes to take effect."
                               Foreground="{DynamicResource SecondaryTextBrush}"
                               FontStyle="Italic" Margin="0,15,0,0" TextWrapping="Wrap"/>
                </StackPanel>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <Border Grid.Row="1" Background="{DynamicResource StatusBarBackgroundBrush}"
                Padding="10,8" Margin="0,10,0,0" CornerRadius="4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding StatusText}" Foreground="{DynamicResource SecondaryTextBrush}"/>
                <ProgressBar Grid.Column="1" Width="100" Height="8" Margin="10,0,0,0"
                             Value="{Binding Progress}" Maximum="100"
                             Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibility}}"/>
            </Grid>
        </Border>
    </Grid>
</Window>
