<Window x:Class="RVUCounter.Views.ToolsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Tools"
        Width="600" Height="550"
        WindowStartupLocation="Manual"
        Background="{DynamicResource WindowBackgroundBrush}"
        TextElement.Foreground="{DynamicResource PrimaryTextBrush}">
    
    <Window.Resources>
        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Width" Value="100"/>
        </Style>
        
        <Style x:Key="FieldInput" TargetType="TextBox">
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Background" Value="{DynamicResource CardBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
        </Style>
    </Window.Resources>
    
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <TabControl Grid.Row="0" Background="{DynamicResource PanelBackgroundBrush}" BorderBrush="{DynamicResource BorderBrush}">
            <!-- Manual Entry Tab -->
            <TabItem Header="Manual Entry">
                <StackPanel Margin="15">
                    <TextBlock Text="Add Study Manually" FontWeight="Bold" FontSize="14" Margin="0,0,0,15"/>
                    <TextBlock Text="Add a study that wasn't automatically detected." 
                               Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,15"/>
                    
                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Style="{StaticResource FieldLabel}" Text="Accession:"/>
                        <TextBox Grid.Column="1" Style="{StaticResource FieldInput}"
                                 Text="{Binding ManualAccession}" 
                                 MaxWidth="200" HorizontalAlignment="Left"/>
                    </Grid>
                    
                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Style="{StaticResource FieldLabel}" Text="Study Type:*"/>
                        <ComboBox Grid.Column="1" Text="{Binding ManualStudyType}" 
                                  IsEditable="True" MaxWidth="200" HorizontalAlignment="Left"
                                  ItemsSource="{Binding StudyTypes}"
                                  Foreground="{DynamicResource PrimaryTextBrush}"/>
                    </Grid>
                    
                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Style="{StaticResource FieldLabel}" Text="RVU:"/>
                        <TextBox Grid.Column="1" Style="{StaticResource FieldInput}"
                                 Text="{Binding ManualRvu, StringFormat=F2}" 
                                 MaxWidth="80" HorizontalAlignment="Left"/>
                    </Grid>
                    
                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Style="{StaticResource FieldLabel}" Text="Procedure:"/>
                        <TextBox Grid.Column="1" Style="{StaticResource FieldInput}"
                                 Text="{Binding ManualProcedure}"/>
                    </Grid>
                    
                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Style="{StaticResource FieldLabel}" Text="Patient Class:"/>
                        <ComboBox Grid.Column="1" SelectedItem="{Binding ManualPatientClass}"
                                  MaxWidth="150" HorizontalAlignment="Left" Foreground="{DynamicResource PrimaryTextBrush}">
                            <ComboBoxItem Content=""/>
                            <ComboBoxItem Content="Inpatient"/>
                            <ComboBoxItem Content="Outpatient"/>
                            <ComboBoxItem Content="Emergency"/>
                        </ComboBox>
                    </Grid>
                    
                    <Button Content="Add Study" Padding="15,8" Margin="0,20,0,0"
                            HorizontalAlignment="Left"
                            Command="{Binding AddManualStudyCommand}"
                            Background="{DynamicResource AccentBrush}" Foreground="White" BorderThickness="0"/>
                </StackPanel>
            </TabItem>
            
            <!-- Database Tab -->
            <TabItem Header="Database">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Margin="0,0,0,15">
                        <TextBlock Text="Database Statistics" FontWeight="Bold" FontSize="14"/>
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <TextBlock Text="Total Shifts: "/>
                            <TextBlock Text="{Binding TotalShifts}" FontWeight="Bold" Margin="0,0,20,0"/>
                            <TextBlock Text="Total Studies: "/>
                            <TextBlock Text="{Binding TotalStudies}" FontWeight="Bold" Margin="0,0,20,0"/>
                            <TextBlock Text="Total RVU: "/>
                            <TextBlock Text="{Binding TotalRvu, StringFormat=F1}" FontWeight="Bold"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Content="Scan" Padding="10,5" Margin="0,0,8,0"
                                Command="{Binding ScanDatabaseCommand}"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolToVisibility}}"/>
                        <Button Content="Fix" Padding="10,5" Margin="0,0,8,0"
                                Command="{Binding FixDatabaseCommand}"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolToVisibility}}"/>
                        <Button Content="Repair (Full)" Padding="10,5" Margin="0,0,8,0"
                                Command="{Binding RepairDatabaseCommand}"
                                ToolTip="Re-match all records against current RVU rules"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolToVisibility}}"/>
                        <Button Content="Open Folder" Padding="10,5" Margin="0,0,8,0"
                                Command="{Binding OpenDatabaseCommand}"/>
                        <Button Content="Logs" Padding="10,5"
                                Command="{Binding ViewLogsCommand}"/>
                    </StackPanel>
                    
                    <Border Grid.Row="2" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="4" Background="{DynamicResource CardBackgroundBrush}">
                        <ScrollViewer>
                            <TextBox Text="{Binding ReportText}" 
                                     IsReadOnly="True" 
                                     FontFamily="Consolas"
                                     FontSize="11"
                                     TextWrapping="Wrap"
                                     BorderThickness="0"
                                     Padding="10"
                                     Background="Transparent"
                                     Foreground="{DynamicResource PrimaryTextBrush}"/>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </TabItem>
            
            <!-- Excel Audit Tab -->
            <TabItem Header="Excel Audit">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Margin="0,0,0,15">
                        <TextBlock Text="Excel File Audit" FontWeight="Bold" FontSize="14"/>
                        <TextBlock Text="Compare payroll Excel files with database records."
                                   Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,5,0,0"/>
                    </StackPanel>

                    <Grid Grid.Row="1" Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Excel File:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBox Grid.Column="1" Text="{Binding ExcelFilePath}"
                                 IsReadOnly="True" Padding="6,4"
                                 Background="{DynamicResource CardBackgroundBrush}"
                                 Foreground="{DynamicResource PrimaryTextBrush}"/>
                        <Button Grid.Column="2" Content="Browse..." Padding="10,4" Margin="10,0,0,0"
                                Command="{Binding BrowseExcelFileCommand}"/>
                    </Grid>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Content="Run Audit" Padding="10,5" Margin="0,0,10,0"
                                Command="{Binding RunExcelAuditCommand}"
                                ToolTip="Compare accessions between Excel and database"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolToVisibility}}"/>
                        <Button Content="Check RVU" Padding="10,5" Margin="0,0,10,0"
                                Command="{Binding CheckExcelRvuCommand}"
                                ToolTip="Check Excel RVU values against current rules"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolToVisibility}}"/>
                        <Button Content="Detect Time Offset" Padding="10,5" Margin="0,0,10,0"
                                Command="{Binding DetectTimeOffsetCommand}"
                                ToolTip="Calculate time offset between Excel and database"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolToVisibility}}"/>
                        <Button Content="Apply Offset" Padding="10,5"
                                Command="{Binding ApplyTimeOffsetCommand}"
                                ToolTip="Apply detected time offset to current shift"
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolToVisibility}}"/>
                    </StackPanel>

                    <Border Grid.Row="3" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="4" Background="{DynamicResource CardBackgroundBrush}">
                        <ScrollViewer>
                            <TextBox Text="{Binding ReportText}"
                                     IsReadOnly="True"
                                     FontFamily="Consolas"
                                     FontSize="11"
                                     TextWrapping="Wrap"
                                     BorderThickness="0"
                                     Padding="10"
                                     Background="Transparent"
                                     Foreground="{DynamicResource PrimaryTextBrush}"/>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Backup Tab -->
            <TabItem Header="Backup">
                <StackPanel Margin="15">
                    <TextBlock Text="Backup and Restore" FontWeight="Bold" FontSize="14" Margin="0,0,0,15"/>
                    <TextBlock Text="Export your database or settings for backup purposes." 
                               Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,20"/>
                    
                    <Button Content="Export Database..." Padding="15,8" Margin="0,0,0,10"
                            HorizontalAlignment="Left" Width="180"
                            Click="ExportDatabase_Click"/>
                    
                    <Button Content="Export Settings..." Padding="15,8" Margin="0,0,0,10"
                            HorizontalAlignment="Left" Width="180"
                            Click="ExportSettings_Click"/>
                    
                    <Separator Margin="0,20" Background="{DynamicResource SeparatorBrush}"/>
                    
                    <Button Content="Import Database..." Padding="15,8" Margin="0,10,0,10"
                            HorizontalAlignment="Left" Width="180"
                            Click="ImportDatabase_Click"/>
                </StackPanel>
            </TabItem>
        </TabControl>
        
        <!-- Status Bar -->
        <Border Grid.Row="1" Background="{DynamicResource StatusBarBackgroundBrush}" Padding="10,8" Margin="0,10,0,0" CornerRadius="4">
            <TextBlock Text="{Binding StatusText}" Foreground="{DynamicResource SecondaryTextBrush}"/>
        </Border>
    </Grid>
</Window>
